import{createRequire as ae}from"module";import w from"path";import h from"fs-extra";import le from"yaml";import ce from"yargs";function p(e){let r=String(e).trim();if(typeof e=="number")return{isValid:!0,value:{kind:"NumberValue",value:e}};let n=E(r);if(n.isValid)return n;let t=D(r);if(t.isValid)return t;let o=O(r);if(o.isValid)return o;let s=S(r);if(s.isValid)return s;let i=Y(r);if(i.isValid)return i;let a=P(r);if(a.isValid)return a;let l=_(r);return l.isValid?l:{isValid:!0,value:{kind:"StringValue",value:r}}}function f(e){switch(e.kind){case"HexColor":return e.value;case"RgbColor":return`rgb(${e.r}, ${e.g}, ${e.b})`;case"RgbaColor":return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`;case"TokenRef":return`$${e.collection}.${e.token}`;case"SizeValue":return`${e.value}${e.unit}`;case"DurationValue":return`${e.value}${e.unit}`;case"NumberValue":return e.value.toString();case"StringValue":return e.value;case"ShadowLayer":let r=f(e.offsetX),n=f(e.offsetY),t=f(e.blur),o=f(e.spread),s=f(e.color);return`${r} ${n} ${t} ${o} ${s}`;case"Shadow":return e.layers.map(i=>f(i)).join(", ");default:return String(e)}}function E(e){return/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{4}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(e)?{isValid:!0,value:{kind:"HexColor",value:e}}:{isValid:!1,error:`Invalid hex color: ${e}`}}function D(e){let r=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/,n=e.match(r);if(!n)return{isValid:!1,error:`Invalid rgb color: ${e}`};let[,t,o,s]=n,i=parseInt(t,10),a=parseInt(o,10),l=parseInt(s,10);return i<0||i>255||a<0||a>255||l<0||l>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:{isValid:!0,value:{kind:"RgbColor",r:i,g:a,b:l}}}function O(e){let r=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([01]?\.?\d*)\s*\)$/,n=e.match(r);if(!n)return{isValid:!1,error:`Invalid rgba color: ${e}`};let[,t,o,s,i]=n,a=parseInt(t,10),l=parseInt(o,10),c=parseInt(s,10),u=parseFloat(i);return a<0||a>255||l<0||l>255||c<0||c>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:u<0||u>1?{isValid:!1,error:`Invalid alpha value: ${e}`}:{isValid:!0,value:{kind:"RgbaColor",r:a,g:l,b:c,a:u}}}function S(e){if(!/^\$[a-zA-Z0-9][a-zA-Z0-9_-]*(?:\.[a-zA-Z0-9][a-zA-Z0-9_-]*)+$/.test(e))return{isValid:!1,error:`Invalid token reference: ${e}`};let t=e.substring(1).split(".");if(t.length<2)return{isValid:!1,error:`Invalid token format: ${e}`};let o=t[t.length-1];return{isValid:!0,value:{kind:"TokenRef",collection:t.slice(0,-1).join("."),token:o}}}function P(e){let r=/^([+-]?\d*\.?\d+)(px|rem|em|vw|vh|%)$/,n=e.match(r);if(!n)return{isValid:!1,error:`Invalid size: ${e}`};let[,t,o]=n,s=parseFloat(t);return isNaN(s)?{isValid:!1,error:`Invalid size value: ${e}`}:{isValid:!0,value:{kind:"SizeValue",value:s,unit:o}}}function _(e){let r=/^([+-]?\d*\.?\d+)(ms|s)$/,n=e.match(r);if(!n)return{isValid:!1,error:`Invalid duration: ${e}`};let[,t,o]=n,s=parseFloat(t);return isNaN(s)?{isValid:!1,error:`Invalid duration value: ${e}`}:{isValid:!0,value:{kind:"DurationValue",value:s,unit:o}}}function W(e){if(!e)return{isValid:!1,error:"Missing color value"};if(e.startsWith("$"))return S(e);if(e.startsWith("var("))return{isValid:!0,value:{kind:"StringValue",value:e}};let r=E(e);if(r.isValid)return r;let n=D(e);if(n.isValid)return n;let t=O(e);return t.isValid?t:{isValid:!1,error:`Invalid color: ${e}`}}function Y(e){if(!e.includes("px")&&!e.includes("$"))return{isValid:!1,error:`Invalid shadow format: ${e}`};try{let r=e.split(",").map(t=>t.trim()),n=[];for(let t of r){let o=B(t);if(!o.isValid||!o.value)return{isValid:!1,error:`Invalid shadow layer: ${t}`};n.push(o.value)}return{isValid:!0,value:{kind:"Shadow",layers:n}}}catch{return{isValid:!1,error:`Invalid shadow format: ${e}`}}}function B(e){let r=e.trim().split(/\s+/);if(r.length<4)return{isValid:!1,error:`Invalid shadow layer format: ${e}`};try{let n=$(r[0]),t=$(r[1]),o=$(r[2]),s=$(r[3]);if(!n.isValid||!t.isValid||!o.isValid||!s.isValid)return{isValid:!1,error:`Invalid shadow dimensions: ${e}`};let i=r.slice(4).join(" ").trim(),a=W(i);return a.isValid?{isValid:!0,value:{kind:"ShadowLayer",color:a.value,offsetX:n.value,offsetY:t.value,blur:o.value,spread:s.value}}:{isValid:!1,error:`Invalid shadow color: ${i}`}}catch{return{isValid:!1,error:`Invalid shadow layer: ${e}`}}}function $(e){return e.startsWith("$")?S(e):P(e)}function V(e,r){return{tokens:U(e),collections:X(r)}}function X(e){return e.data.map(r=>({name:r.name,modes:r.modes}))}function H(e){let{collection:r,tokens:n}=e.data;return Object.entries(n).map(([t,o])=>{let s=Object.entries(o.values).map(([i,a])=>({mode:i,value:a}));return{token:{name:t,collection:r},values:s}})}function U(e){return e.flatMap(H)}function Z(e){return p(e)}function q(e){let r=[];return e.forEach(n=>{n.values.forEach(t=>{let o=Z(t.value);r.push({tokenName:n.token.name,collection:n.token.collection,mode:t.mode,value:t.value,result:o})})}),r}function m(e){let r=[];return e.kind==="TokenRef"?r.push({collection:e.collection,token:e.token}):e.kind==="ShadowLayer"?(r.push(...m(e.color)),r.push(...m(e.offsetX)),r.push(...m(e.offsetY)),r.push(...m(e.blur)),r.push(...m(e.spread))):e.kind==="Shadow"&&e.layers.forEach(n=>{r.push(...m(n))}),r}function K(e,r){let n=[],t=[],o=e.data.collection,s=r.get(o);return s?(Object.entries(e.data.tokens).forEach(([i,a])=>{let l=Object.keys(a.values),c=s.modes.filter(u=>!l.includes(u));c.length>0&&n.push({type:"MISSING_MODE",message:`Token '${i}' is missing modes: ${c.join(", ")}`,tokenName:i,collection:o}),Object.entries(a.values).forEach(([u,g])=>{let d=p(g);d.isValid||n.push({type:"INVALID_VALUE_FORMAT",message:d.error||`Invalid value format for token '${i}' in mode '${u}'`,tokenName:i,collection:o,mode:u,value:g})})}),{isValid:n.length===0,errors:n,warnings:t}):(n.push({type:"INVALID_COLLECTION",message:`Collection '${o}' is not defined`,collection:o}),{isValid:!1,errors:n,warnings:t})}function J(e,r){let n=[],t=[];return q(e).forEach(({tokenName:s,collection:i,mode:a,value:l,result:c})=>{if(!c.isValid){n.push({type:"INVALID_VALUE_FORMAT",message:c.error||"Invalid value format",tokenName:s,collection:i,mode:a,value:l});return}c.value&&m(c.value).forEach(({collection:g,token:d})=>{let A=`$${g}.${d}`;r.find(G=>G.token.name===A)||n.push({type:"INVALID_PRIMITIVE_TOKEN",message:`Referenced token '${A}' not found`,tokenName:s,collection:i,mode:a,value:l})})}),{isValid:n.length===0,errors:n,warnings:t}}function T(e,r){let n=[],t=[];e.forEach(a=>{let l=K(a,r);n.push(...l.errors),t.push(...l.warnings)});let o={kind:"TokenCollections",metadata:{id:"temp",name:"temp"},data:Array.from(r.values())},s=V(e,o),i=J(s.tokens,s.tokens);return n.push(...i.errors),t.push(...i.warnings),{isValid:n.length===0,errors:n,warnings:t}}function y(e,r,n){return{resolve(t){return k(t,e,r,n)},resolveTokenRef(t){let o=`$${t.collection}.${t.token}`;if(!e.find(a=>a.token.name===o))throw new Error(`Token not found: ${o}`);return`var(${n(o)})`}}}function k(e,r,n,t){switch(e.kind){case"TokenRef":let o=`$${e.collection}.${e.token}`;if(!r.find(a=>a.token.name===o))throw new Error(`Token not found: ${o}`);return{kind:"StringValue",value:`var(${t(o)})`};case"ShadowLayer":return{kind:"ShadowLayer",color:k(e.color,r,n,t),offsetX:k(e.offsetX,r,n,t),offsetY:k(e.offsetY,r,n,t),blur:k(e.blur,r,n,t),spread:k(e.spread,r,n,t)};case"Shadow":return{kind:"Shadow",layers:e.layers.map(a=>k(a,r,n,t))};default:return e}}function b(e,r){let n=e.replace(/^\$/,"").replace(/\./g,"-");return r?`--${r}-${n}`:`--${n}`}function N(e){return typeof e=="string"?e:typeof e=="number"?e.toString():f(e)}function Q(e,r,n){let t=String(e);if(!t.startsWith("$")){let i=p(t);if(i.isValid&&i.value){let l=y(r,"default",c=>b(c,n)).resolve(i.value);return N(l)}return e}let o=p(t);if(!o.isValid||!o.value)throw new Error(`Invalid token reference: ${t}`);return y(r,"default",i=>b(i,n)).resolveTokenRef(o.value)}function ee(e,r,n,t){let o=e.values.find(a=>a.mode===r);if(!o)throw new Error(`No value found for token '${e.token.name}' in mode '${r}'`);let s=Q(o.value,n,t);return`${b(e.token.name,t)}: ${N(s)};`}function re(e,r,n,t,o){let s=r.map(i=>`  ${ee(i,n,t,o)}`).join(`
`);return`${e} {
${s}
}`}function z(e,r){let{prefix:n,banner:t="",selectors:o}=r,{tokens:s,collections:i}=e,a=i.flatMap(l=>{let c=s.filter(u=>u.token.collection===l.name);return l.modes.map(u=>{var d;let g=(d=o[l.name])==null?void 0:d[u];if(!g)throw new Error(`Selector for collection ${l.name} and mode ${u} is not defined`);return re(g,c,u,s,n)})}).join(`

`);return`${t}${a}`}function ne(e,r,n){let t=new Map(r.data.map(i=>[i.name,i])),o=T(e,t);if(!o.isValid)throw console.error("Token validation failed:"),o.errors.forEach(i=>{console.error(`  ${i.message}`)}),new Error("Token validation failed. Please fix the errors above.");o.warnings.length>0&&(console.warn("Token validation warnings:"),o.warnings.forEach(i=>{console.warn(`  ${i}`)}));let s=V(e,r);return z(s,n)}var R={generateCssVariables:ne,generateCssVarsFromAst:z,createCssVarName:b};function v(e,r){let n=e.replace(/^\$/,"").replace(/\./g,"-");return r?`--${r}-${n}`:`--${n}`}function x(e){return typeof e=="string"?e:typeof e=="number"?e.toString():f(e)}function te(e,r,n){let t=String(e);if(!t.startsWith("$")){let i=p(t);if(i.isValid&&i.value){let l=y(r,"default",c=>v(c,n)).resolve(i.value);return x(l)}return e}let o=p(t);if(!o.isValid||!o.value)throw new Error(`Invalid token reference: ${t}`);return y(r,"default",i=>v(i,n)).resolveTokenRef(o.value)}function oe(e,r,n){let{prefix:t}=n,o=[],s=new Set;return e.forEach(i=>{if(s.has(i.token.name))return;s.add(i.token.name);let a=i.values.find(d=>d.mode===r);if(!a)return;let l=te(a.value,e,t),c=i.token.name,u;if(c.startsWith("$number.")){let d=c.replace("$number.","");u=v(`spacing-${d}`,t),d==="1"&&o.push(`  --spacing: ${x(l)};`)}else if(c.startsWith("$letter-spacing.")){let d=c.replace("$letter-spacing.","");u=v(`tracking-${d}`,t)}else u=v(c,t);let g=x(l);o.push(`  ${u}: ${g};`)}),o.length>0?`@theme {
${o.join(`
`)}
}`:""}function ie(){let e=[];return e.push("@utility bg-* { background-color: var(--color-*, var(--color-palette-*)); }","@utility text-* { color: var(--color-*, var(--color-palette-*)); }","@utility border-* { border-color: var(--color-*, var(--color-palette-*)); }","@utility fill-* { fill: var(--color-*, var(--color-palette-*)); }","@utility stroke-* { stroke: var(--color-*, var(--color-palette-*)); }","","@utility font-* { font-weight: var(--font-weight-*); }","@utility tracking-* { letter-spacing: var(--tracking-*); }","","@utility p-* { padding: var(--spacing-*); }","@utility px-* { padding-left: var(--spacing-*); padding-right: var(--spacing-*); }","@utility py-* { padding-top: var(--spacing-*); padding-bottom: var(--spacing-*); }","@utility pt-* { padding-top: var(--spacing-*); }","@utility pr-* { padding-right: var(--spacing-*); }","@utility pb-* { padding-bottom: var(--spacing-*); }","@utility pl-* { padding-left: var(--spacing-*); }","","@utility m-* { margin: var(--spacing-*); }","@utility mx-* { margin-left: var(--spacing-*); margin-right: var(--spacing-*); }","@utility my-* { margin-top: var(--spacing-*); margin-bottom: var(--spacing-*); }","@utility mt-* { margin-top: var(--spacing-*); }","@utility mr-* { margin-right: var(--spacing-*); }","@utility mb-* { margin-bottom: var(--spacing-*); }","@utility ml-* { margin-left: var(--spacing-*); }","","@utility w-* { width: var(--spacing-*); }","@utility h-* { height: var(--spacing-*); }","@utility min-w-* { min-width: var(--spacing-*); }","@utility min-h-* { min-height: var(--spacing-*); }","@utility max-w-* { max-width: var(--spacing-*); }","@utility max-h-* { max-height: var(--spacing-*); }","@utility gap-* { gap: var(--spacing-*); }","@utility space-x-* > * + * { margin-left: var(--spacing-*); }","@utility space-y-* > * + * { margin-top: var(--spacing-*); }","@utility rounded-* { border-radius: var(--spacing-*); }","","@utility shadow-* { box-shadow: var(--shadow-*); }","@utility border-*-width { border-width: var(--border-width-*); }"),e}function F(e,r){let{banner:n=""}=r,{tokens:t,collections:o}=e,s=[];n&&s.push(n),s.push('@import "tailwindcss";'),s.push(""),o.forEach(a=>{let l=t.filter(c=>c.token.collection===a.name);a.modes.forEach(c=>{let u=oe(l,c,r);u&&(s.push(u),s.push(""))})});let i=ie();return i.length>0&&(s.push(...i),s.push("")),s.join(`
`)}function se(e,r,n){let t=new Map(r.data.map(i=>[i.name,i])),o=T(e,t);if(!o.isValid)throw console.error("Token validation failed:"),o.errors.forEach(i=>{console.error(`  ${i.message}`)}),new Error("Token validation failed. Please fix the errors above.");o.warnings.length>0&&(console.warn("Token validation warnings:"),o.warnings.forEach(i=>{console.warn(`  ${i}`)}));let s=V(e,r);return F(s,n)}var C={generateTailwindCSS:se,generateTailwindFromAst:F,createCssVarName:v};var ue=ae(import.meta.url),de=ue.resolve("@cocso-ui/baseframe-sources"),fe=w.dirname(de);function I(){process.stdout.write(`
\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2557   \u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2588\u2588\u2588\u2588\u2554\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2557  
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u255A\u2550\u2550\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2551\u255A\u2588\u2588\u2554\u255D\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551     \u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551 \u255A\u2550\u255D \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u255A\u2550\u2550\u2550\u2550\u2550\u255D \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D

`)}function ge(e){let r=[];function n(t){let o=h.readdirSync(t);for(let s of o){let i=w.join(t,s),a=h.statSync(i);a.isDirectory()?n(i):a.isFile()&&/\.ya?ml$/.test(s)&&r.push(i)}}return n(e),r}function j(){let e=ge(fe),r=[],n=null;for(let t of e)try{let o=h.readFileSync(t,"utf-8"),s=le.parse(o);s.kind==="Tokens"?r.push(s):s.kind==="TokenCollections"&&(n=s)}catch(o){console.warn(` \u274E failed to parse ${t}:`,o)}return{tokens:r,collections:n}}function L(e,r){let{tokens:n,collections:t}=j();t||(console.error(" \u274E collections.yaml not found"),process.exit(1));let o=R.generateCssVariables(n,t,{prefix:r,banner:`/* Generated CSS Variables for Baseframe Design Tokens */
/* Generated at: ${new Date().toISOString()} */

`,selectors:{global:{default:":root"}}});h.ensureDirSync(e);let s=w.join(e,"tokens.css");h.writeFileSync(s,o,"utf-8"),console.log(` \u2705 Generated CSS variables: ${s}`)}function M(e,r){let{tokens:n,collections:t}=j();t||(console.error(" \u274E collections.yaml not found"),process.exit(1));let o=C.generateTailwindCSS(n,t,{prefix:r,banner:`/* Generated TailwindCSS 4.0 Configuration for Baseframe Design Tokens */
/* Generated at: ${new Date().toISOString()} */

`});h.ensureDirSync(e);let s=w.join(e,"tailwind.css");h.writeFileSync(s,o,"utf-8"),console.log(` \u2705 Generated TailwindCSS 4.0 configuration: ${s}`)}ce(process.argv.slice(2)).command("css-vars [dir] [prefix]","Generate CSS variables",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{I(),L(e.dir,e.prefix)}).command("tailwindcss [dir] [prefix]","Generate TailwindCSS 4.0 configuration",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{I(),M(e.dir,e.prefix)}).command("all [dir] [prefix]","Generate all outputs (CSS variables, TailwindCSS)",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{I(),console.log(` \u{1F680} Generating all outputs...
`),L(e.dir,e.prefix),M(e.dir,e.prefix),console.log(`
 \u2728 All outputs generated successfully!`)}).demandCommand(1,"You need to specify a command.").showHelpOnFail(!0).help().argv;
