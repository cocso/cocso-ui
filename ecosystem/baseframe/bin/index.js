#!/usr/bin/env node
var G=Object.defineProperty;var E=(e,r)=>{for(var t in r)G(e,t,{get:r[t],enumerable:!0})};import{createRequire as ae}from"module";import R from"path";import k from"fs-extra";import le from"yaml";import ce from"yargs";function V(e){let r=String(e).trim();if(typeof e=="number")return{isValid:!0,value:{kind:"NumberValue",value:e}};let t=N(r);if(t.isValid)return t;let n=P(r);if(n.isValid)return n;let o=O(r);if(o.isValid)return o;let i=S(r);if(i.isValid)return i;let s=X(r);if(s.isValid)return s;let a=z(r);if(a.isValid)return a;let l=W(r);return l.isValid?l:{isValid:!0,value:{kind:"StringValue",value:r}}}function g(e){switch(e.kind){case"HexColor":return e.value;case"RgbColor":return`rgb(${e.r}, ${e.g}, ${e.b})`;case"RgbaColor":return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`;case"TokenRef":return`$${e.collection}.${e.token}`;case"SizeValue":return`${e.value}${e.unit}`;case"DurationValue":return`${e.value}${e.unit}`;case"NumberValue":return e.value.toString();case"StringValue":return e.value;case"ShadowLayer":let r=g(e.offsetX),t=g(e.offsetY),n=g(e.blur),o=g(e.spread),i=g(e.color);return`${r} ${t} ${n} ${o} ${i}`;case"Shadow":return e.layers.map(s=>g(s)).join(", ");default:return String(e)}}function N(e){return/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{4}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(e)?{isValid:!0,value:{kind:"HexColor",value:e}}:{isValid:!1,error:`Invalid hex color: ${e}`}}function P(e){let r=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid rgb color: ${e}`};let[,n,o,i]=t,s=parseInt(n,10),a=parseInt(o,10),l=parseInt(i,10);return s<0||s>255||a<0||a>255||l<0||l>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:{isValid:!0,value:{kind:"RgbColor",r:s,g:a,b:l}}}function O(e){let r=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([01]?\.?\d*)\s*\)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid rgba color: ${e}`};let[,n,o,i,s]=t,a=parseInt(n,10),l=parseInt(o,10),c=parseInt(i,10),u=parseFloat(s);return a<0||a>255||l<0||l>255||c<0||c>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:u<0||u>1?{isValid:!1,error:`Invalid alpha value: ${e}`}:{isValid:!0,value:{kind:"RgbaColor",r:a,g:l,b:c,a:u}}}function S(e){if(!/^\$[a-zA-Z0-9][a-zA-Z0-9_-]*(?:\.[a-zA-Z0-9][a-zA-Z0-9_-]*)+$/.test(e))return{isValid:!1,error:`Invalid token reference: ${e}`};let n=e.substring(1).split(".");if(n.length<2)return{isValid:!1,error:`Invalid token format: ${e}`};let o=n[n.length-1];return{isValid:!0,value:{kind:"TokenRef",collection:n.slice(0,-1).join("."),token:o}}}function z(e){let r=/^([+-]?\d*\.?\d+)(px|rem|em|vw|vh|%)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid size: ${e}`};let[,n,o]=t,i=parseFloat(n);return isNaN(i)?{isValid:!1,error:`Invalid size value: ${e}`}:{isValid:!0,value:{kind:"SizeValue",value:i,unit:o}}}function W(e){let r=/^([+-]?\d*\.?\d+)(ms|s)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid duration: ${e}`};let[,n,o]=t,i=parseFloat(n);return isNaN(i)?{isValid:!1,error:`Invalid duration value: ${e}`}:{isValid:!0,value:{kind:"DurationValue",value:i,unit:o}}}function H(e){if(!e)return{isValid:!1,error:"Missing color value"};if(e.startsWith("$"))return S(e);if(e.startsWith("var("))return{isValid:!0,value:{kind:"StringValue",value:e}};let r=N(e);if(r.isValid)return r;let t=P(e);if(t.isValid)return t;let n=O(e);return n.isValid?n:{isValid:!1,error:`Invalid color: ${e}`}}function X(e){if(!e.includes("px")&&!e.includes("$"))return{isValid:!1,error:`Invalid shadow format: ${e}`};try{let r=e.split(",").map(n=>n.trim()),t=[];for(let n of r){let o=B(n);if(!o.isValid||!o.value)return{isValid:!1,error:`Invalid shadow layer: ${n}`};t.push(o.value)}return{isValid:!0,value:{kind:"Shadow",layers:t}}}catch{return{isValid:!1,error:`Invalid shadow format: ${e}`}}}function B(e){let r=e.trim().split(/\s+/);if(r.length<4)return{isValid:!1,error:`Invalid shadow layer format: ${e}`};try{let t=v(r[0]),n=v(r[1]),o=v(r[2]),i=v(r[3]);if(!t.isValid||!n.isValid||!o.isValid||!i.isValid)return{isValid:!1,error:`Invalid shadow dimensions: ${e}`};let s=r.slice(4).join(" ").trim(),a=H(s);return a.isValid?{isValid:!0,value:{kind:"ShadowLayer",color:a.value,offsetX:t.value,offsetY:n.value,blur:o.value,spread:i.value}}:{isValid:!1,error:`Invalid shadow color: ${s}`}}catch{return{isValid:!1,error:`Invalid shadow layer: ${e}`}}}function v(e){return e.startsWith("$")?S(e):z(e)}function b(e,r){return{tokens:q(e),collections:U(r)}}function U(e){return e.data.map(r=>({name:r.name,modes:r.modes}))}function Z(e){let{collection:r,tokens:t}=e.data;return Object.entries(t).map(([n,o])=>{let i=Object.entries(o.values).map(([s,a])=>({mode:s,value:a}));return{token:{name:n,collection:r},values:i}})}function q(e){return e.flatMap(Z)}function K(e){return V(e)}function J(e){let r=[];return e.forEach(t=>{t.values.forEach(n=>{let o=K(n.value);r.push({tokenName:t.token.name,collection:t.token.collection,mode:n.mode,value:n.value,result:o})})}),r}function m(e){let r=[];return e.kind==="TokenRef"?r.push({collection:e.collection,token:e.token}):e.kind==="ShadowLayer"?(r.push(...m(e.color)),r.push(...m(e.offsetX)),r.push(...m(e.offsetY)),r.push(...m(e.blur)),r.push(...m(e.spread))):e.kind==="Shadow"&&e.layers.forEach(t=>{r.push(...m(t))}),r}function Q(e,r){let t=[],n=[],o=e.data.collection,i=r.get(o);return i?(Object.entries(e.data.tokens).forEach(([s,a])=>{let l=Object.keys(a.values),c=i.modes.filter(u=>!l.includes(u));c.length>0&&t.push({type:"MISSING_MODE",message:`Token '${s}' is missing modes: ${c.join(", ")}`,tokenName:s,collection:o}),Object.entries(a.values).forEach(([u,p])=>{let d=V(p);d.isValid||t.push({type:"INVALID_VALUE_FORMAT",message:d.error||`Invalid value format for token '${s}' in mode '${u}'`,tokenName:s,collection:o,mode:u,value:p})})}),{isValid:t.length===0,errors:t,warnings:n}):(t.push({type:"INVALID_COLLECTION",message:`Collection '${o}' is not defined`,collection:o}),{isValid:!1,errors:t,warnings:n})}function ee(e,r){let t=[],n=[];return J(e).forEach(({tokenName:i,collection:s,mode:a,value:l,result:c})=>{if(!c.isValid){t.push({type:"INVALID_VALUE_FORMAT",message:c.error||"Invalid value format",tokenName:i,collection:s,mode:a,value:l});return}c.value&&m(c.value).forEach(({collection:p,token:d})=>{let D=`$${p}.${d}`;r.find(Y=>Y.token.name===D)||t.push({type:"INVALID_PRIMITIVE_TOKEN",message:`Referenced token '${D}' not found`,tokenName:i,collection:s,mode:a,value:l})})}),{isValid:t.length===0,errors:t,warnings:n}}function F(e,r){let t=[],n=[];e.forEach(a=>{let l=Q(a,r);t.push(...l.errors),n.push(...l.warnings)});let o={kind:"TokenCollections",metadata:{id:"temp",name:"temp"},data:Array.from(r.values())},i=b(e,o),s=ee(i.tokens,i.tokens);return t.push(...s.errors),n.push(...s.warnings),{isValid:t.length===0,errors:t,warnings:n}}function $(e,r){let t=new Map(r.data.map(o=>[o.name,o])),n=F(e,t);if(!n.isValid)throw console.error("Token validation failed:"),n.errors.forEach(o=>{console.error(`  ${o.message}`)}),new Error("Token validation failed. Please fix the errors above.");return n.warnings.length>0&&(console.warn("Token validation warnings:"),n.warnings.forEach(o=>{console.warn(`  ${o}`)})),b(e,r)}function C(e,r,t){return{resolve(n){return h(n,e,r,t)},resolveTokenRef(n){let o=`$${n.collection}.${n.token}`;if(!e.find(a=>a.token.name===o))throw new Error(`Token not found: ${o}`);return`var(${t(o)})`}}}function h(e,r,t,n){switch(e.kind){case"TokenRef":let o=`$${e.collection}.${e.token}`;if(!r.find(a=>a.token.name===o))throw new Error(`Token not found: ${o}`);return{kind:"StringValue",value:`var(${n(o)})`};case"ShadowLayer":return{kind:"ShadowLayer",color:h(e.color,r,t,n),offsetX:h(e.offsetX,r,t,n),offsetY:h(e.offsetY,r,t,n),blur:h(e.blur,r,t,n),spread:h(e.spread,r,t,n)};case"Shadow":return{kind:"Shadow",layers:e.layers.map(a=>h(a,r,t,n))};default:return e}}var w={};E(w,{cssVars:()=>ne,generateCssVariables:()=>L,generateFromAst:()=>A});function f(e,r){let t=e.replace(/^\$/,"").replace(/\./g,"-");return r?`--${r}-${t}`:`--${t}`}function y(e){return typeof e=="string"?e:typeof e=="number"?e.toString():g(e)}function T(e,r,t){let n=String(e);if(!n.startsWith("$")){let s=V(n);if(s.isValid&&s.value){let l=C(r,"default",c=>f(c,t)).resolve(s.value);return y(l)}return e}let o=V(n);if(!o.isValid||!o.value)throw new Error(`Invalid token reference: ${n}`);return C(r,"default",s=>f(s,t)).resolveTokenRef(o.value)}function re(e,r,t,n){let o=e.values.find(a=>a.mode===r);if(!o)throw new Error(`No value found for token '${e.token.name}' in mode '${r}'`);let i=T(o.value,t,n);return`${f(e.token.name,n)}: ${y(i)};`}function te(e,r,t,n,o){let i=r.map(s=>`  ${re(s,t,n,o)}`).join(`
`);return`${e} {
${i}
}`}function A(e,r){let{prefix:t,banner:n="",selectors:o={}}=r,{tokens:i,collections:s}=e,a=s.flatMap(l=>{let c=i.filter(u=>u.token.collection===l.name);return l.modes.map(u=>{var d;let p=((d=o[l.name])==null?void 0:d[u])||":root";return te(p,c,u,i,t)})}).join(`

`);return`${n}${a}`}function L(e,r,t={}){let n=$(e,r);return A(n,t)}var ne={generateCssVariables:L,generateCssVarsFromAst:A,createCssVarName:f};var x={};E(x,{generateFromAst:()=>I,generateTailwindCSS:()=>j,tailwind:()=>se});function oe(e,r,t){let{prefix:n}=t,o=[],i=new Set;return e.forEach(s=>{if(i.has(s.token.name))return;i.add(s.token.name);let a=s.values.find(d=>d.mode===r);if(!a)return;let l=T(a.value,e,n),c=s.token.name,u;if(c.startsWith("$number.")){let d=c.replace("$number.","");u=f(`spacing-${d}`,n),d==="1"&&o.push(`  --spacing: ${y(l)};`)}else if(c.startsWith("$letter-spacing.")){let d=c.replace("$letter-spacing.","");u=f(`tracking-${d}`,n)}else u=f(c,n);let p=y(l);o.push(`  ${u}: ${p};`)}),o.length>0?`@theme {
${o.join(`
`)}
}`:""}function ie(){let e=[];return e.push("@utility bg-* { background-color: var(--color-*, var(--color-palette-*)); }","@utility text-* { color: var(--color-*, var(--color-palette-*)); }","@utility border-* { border-color: var(--color-*, var(--color-palette-*)); }","@utility fill-* { fill: var(--color-*, var(--color-palette-*)); }","@utility stroke-* { stroke: var(--color-*, var(--color-palette-*)); }","","@utility font-* { font-weight: var(--font-weight-*); }","@utility tracking-* { letter-spacing: var(--tracking-*); }","","@utility p-* { padding: var(--spacing-*); }","@utility px-* { padding-left: var(--spacing-*); padding-right: var(--spacing-*); }","@utility py-* { padding-top: var(--spacing-*); padding-bottom: var(--spacing-*); }","@utility pt-* { padding-top: var(--spacing-*); }","@utility pr-* { padding-right: var(--spacing-*); }","@utility pb-* { padding-bottom: var(--spacing-*); }","@utility pl-* { padding-left: var(--spacing-*); }","","@utility m-* { margin: var(--spacing-*); }","@utility mx-* { margin-left: var(--spacing-*); margin-right: var(--spacing-*); }","@utility my-* { margin-top: var(--spacing-*); margin-bottom: var(--spacing-*); }","@utility mt-* { margin-top: var(--spacing-*); }","@utility mr-* { margin-right: var(--spacing-*); }","@utility mb-* { margin-bottom: var(--spacing-*); }","@utility ml-* { margin-left: var(--spacing-*); }","","@utility w-* { width: var(--spacing-*); }","@utility h-* { height: var(--spacing-*); }","@utility min-w-* { min-width: var(--spacing-*); }","@utility min-h-* { min-height: var(--spacing-*); }","@utility max-w-* { max-width: var(--spacing-*); }","@utility max-h-* { max-height: var(--spacing-*); }","@utility gap-* { gap: var(--spacing-*); }","@utility space-x-* > * + * { margin-left: var(--spacing-*); }","@utility space-y-* > * + * { margin-top: var(--spacing-*); }","@utility rounded-* { border-radius: var(--spacing-*); }","","@utility shadow-* { box-shadow: var(--shadow-*); }","@utility border-*-width { border-width: var(--border-width-*); }"),e}function I(e,r){let{banner:t=""}=r,{tokens:n,collections:o}=e,i=[];t&&i.push(t),i.push('@import "tailwindcss";'),i.push(""),o.forEach(a=>{let l=n.filter(c=>c.token.collection===a.name);a.modes.forEach(c=>{let u=oe(l,c,r);u&&(i.push(u),i.push(""))})});let s=ie();return s.length>0&&(i.push(...s),i.push("")),i.join(`
`)}function j(e,r,t={}){let n=$(e,r);return I(n,t)}var se={generateTailwindCSS:j,generateTailwindFromAst:I,createCssVarName:f};var ue=ae(import.meta.url),de=ue.resolve("@cocso-ui/baseframe-sources"),fe=R.dirname(de);function M(){process.stdout.write(`
\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2557   \u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2588\u2588\u2588\u2588\u2554\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2557  
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u255A\u2550\u2550\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2551\u255A\u2588\u2588\u2554\u255D\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551     \u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551 \u255A\u2550\u255D \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u255A\u2550\u2550\u2550\u2550\u2550\u255D \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D

`)}function pe(e){let r=[];function t(n){let o=k.readdirSync(n);for(let i of o){let s=R.join(n,i),a=k.statSync(s);a.isDirectory()?t(s):a.isFile()&&/\.ya?ml$/.test(i)&&r.push(s)}}return t(e),r}function _(){let e=pe(fe),r=[],t=null;for(let n of e)try{let o=k.readFileSync(n,"utf-8"),i=le.parse(o);i.kind==="Tokens"?r.push(i):i.kind==="TokenCollections"&&(t=i)}catch(o){console.warn(` \u274E failed to parse ${n}:`,o)}return t||(console.error(" \u274E collections.yaml not found"),process.exit(1)),{tokens:r,collections:t}}function ge(e,r){let{tokens:t,collections:n}=_(),o=w.generateCssVariables(t,n,{prefix:r,banner:"",selectors:{global:{default:":root"}}});k.ensureDirSync(e);let i=R.join(e,"tokens.css");k.writeFileSync(i,o,"utf-8"),console.log(` \u2705 Generated CSS variables: ${i}`)}function me(e,r){let{tokens:t,collections:n}=_(),o=x.generateTailwindCSS(t,n,{prefix:r,banner:""});k.ensureDirSync(e);let i=R.join(e,"tailwind.css");k.writeFileSync(i,o,"utf-8"),console.log(` \u2705 Generated TailwindCSS 4.0 configuration: ${i}`)}ce(process.argv.slice(2)).command("css-vars [dir] [prefix]","Generate CSS variables",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{M(),ge(e.dir,e.prefix)}).command("tailwindcss [dir] [prefix]","Generate TailwindCSS 4.0 configuration",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{M(),me(e.dir,e.prefix)}).demandCommand(1,"You need to specify a command.").showHelpOnFail(!0).help().argv;
