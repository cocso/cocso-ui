#!/usr/bin/env node
var W=Object.defineProperty;var P=(e,r)=>{for(var t in r)W(e,t,{get:r[t],enumerable:!0})};import{createRequire as le}from"module";import R from"path";import h from"fs-extra";import ce from"yaml";import ue from"yargs";function k(e){let r=String(e).trim();if(typeof e=="number")return{isValid:!0,value:{kind:"NumberValue",value:e}};let t=N(r);if(t.isValid)return t;let n=O(r);if(n.isValid)return n;let o=z(r);if(o.isValid)return o;let i=x(r);if(i.isValid)return i;let a=B(r);if(a.isValid)return a;let s=F(r);if(s.isValid)return s;let l=H(r);return l.isValid?l:{isValid:!0,value:{kind:"StringValue",value:r}}}function f(e){switch(e.kind){case"HexColor":return e.value;case"RgbColor":return`rgb(${e.r}, ${e.g}, ${e.b})`;case"RgbaColor":return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`;case"TokenRef":return`$${e.collection}.${e.token}`;case"SizeValue":return`${e.value}${e.unit}`;case"DurationValue":return`${e.value}${e.unit}`;case"NumberValue":return e.value.toString();case"StringValue":return e.value;case"ShadowLayer":let r=f(e.offsetX),t=f(e.offsetY),n=f(e.blur),o=f(e.spread),i=f(e.color);return`${r} ${t} ${n} ${o} ${i}`;case"Shadow":return e.layers.map(a=>f(a)).join(", ");default:return String(e)}}function N(e){return/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{4}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(e)?{isValid:!0,value:{kind:"HexColor",value:e}}:{isValid:!1,error:`Invalid hex color: ${e}`}}function O(e){let r=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid rgb color: ${e}`};let[,n,o,i]=t,a=parseInt(n,10),s=parseInt(o,10),l=parseInt(i,10);return a<0||a>255||s<0||s>255||l<0||l>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:{isValid:!0,value:{kind:"RgbColor",r:a,g:s,b:l}}}function z(e){let r=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([01]?\.?\d*)\s*\)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid rgba color: ${e}`};let[,n,o,i,a]=t,s=parseInt(n,10),l=parseInt(o,10),c=parseInt(i,10),u=parseFloat(a);return s<0||s>255||l<0||l>255||c<0||c>255?{isValid:!1,error:`Invalid RGB values: ${e}`}:u<0||u>1?{isValid:!1,error:`Invalid alpha value: ${e}`}:{isValid:!0,value:{kind:"RgbaColor",r:s,g:l,b:c,a:u}}}function x(e){if(!/^\$[a-zA-Z0-9][a-zA-Z0-9_-]*(?:\.[a-zA-Z0-9][a-zA-Z0-9_-]*)+$/.test(e))return{isValid:!1,error:`Invalid token reference: ${e}`};let n=e.substring(1).split(".");if(n.length<2)return{isValid:!1,error:`Invalid token format: ${e}`};let o=n[n.length-1];return{isValid:!0,value:{kind:"TokenRef",collection:n.slice(0,-1).join("."),token:o}}}function F(e){let r=/^([+-]?\d*\.?\d+)(px|rem|em|vw|vh|%)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid size: ${e}`};let[,n,o]=t,i=parseFloat(n);return isNaN(i)?{isValid:!1,error:`Invalid size value: ${e}`}:{isValid:!0,value:{kind:"SizeValue",value:i,unit:o}}}function H(e){let r=/^([+-]?\d*\.?\d+)(ms|s)$/,t=e.match(r);if(!t)return{isValid:!1,error:`Invalid duration: ${e}`};let[,n,o]=t,i=parseFloat(n);return isNaN(i)?{isValid:!1,error:`Invalid duration value: ${e}`}:{isValid:!0,value:{kind:"DurationValue",value:i,unit:o}}}function X(e){if(!e)return{isValid:!1,error:"Missing color value"};if(e.startsWith("$"))return x(e);if(e.startsWith("var("))return{isValid:!0,value:{kind:"StringValue",value:e}};let r=N(e);if(r.isValid)return r;let t=O(e);if(t.isValid)return t;let n=z(e);return n.isValid?n:{isValid:!1,error:`Invalid color: ${e}`}}function B(e){if(!e.includes("px")&&!e.includes("$"))return{isValid:!1,error:`Invalid shadow format: ${e}`};try{let r=e.split(",").map(n=>n.trim()),t=[];for(let n of r){let o=U(n);if(!o.isValid||!o.value)return{isValid:!1,error:`Invalid shadow layer: ${n}`};t.push(o.value)}return{isValid:!0,value:{kind:"Shadow",layers:t}}}catch{return{isValid:!1,error:`Invalid shadow format: ${e}`}}}function U(e){let r=e.trim().split(/\s+/);if(r.length<4)return{isValid:!1,error:`Invalid shadow layer format: ${e}`};try{let t=y(r[0]),n=y(r[1]),o=y(r[2]),i=y(r[3]);if(!t.isValid||!n.isValid||!o.isValid||!i.isValid)return{isValid:!1,error:`Invalid shadow dimensions: ${e}`};let a=r.slice(4).join(" ").trim(),s=X(a);return s.isValid?{isValid:!0,value:{kind:"ShadowLayer",color:s.value,offsetX:t.value,offsetY:n.value,blur:o.value,spread:i.value}}:{isValid:!1,error:`Invalid shadow color: ${a}`}}catch{return{isValid:!1,error:`Invalid shadow layer: ${e}`}}}function y(e){return e.startsWith("$")?x(e):F(e)}function v(e,r){return{tokens:K(e),collections:Z(r)}}function Z(e){return e.data.map(r=>({name:r.name,modes:r.modes}))}function q(e){let{collection:r,tokens:t}=e.data;return Object.entries(t).map(([n,o])=>{let i=Object.entries(o.values).map(([a,s])=>({mode:a,value:s}));return{token:{name:n,collection:r},values:i}})}function K(e){return e.flatMap(q)}function J(e){return k(e)}function Q(e){let r=[];return e.forEach(t=>{t.values.forEach(n=>{let o=J(n.value);r.push({tokenName:t.token.name,collection:t.token.collection,mode:n.mode,value:n.value,result:o})})}),r}function g(e){let r=[];return e.kind==="TokenRef"?r.push({collection:e.collection,token:e.token}):e.kind==="ShadowLayer"?(r.push(...g(e.color)),r.push(...g(e.offsetX)),r.push(...g(e.offsetY)),r.push(...g(e.blur)),r.push(...g(e.spread))):e.kind==="Shadow"&&e.layers.forEach(t=>{r.push(...g(t))}),r}function ee(e,r){let t=[],n=[],o=e.data.collection,i=r.get(o);return i?(Object.entries(e.data.tokens).forEach(([a,s])=>{let l=Object.keys(s.values),c=i.modes.filter(u=>!l.includes(u));c.length>0&&t.push({type:"MISSING_MODE",message:`Token '${a}' is missing modes: ${c.join(", ")}`,tokenName:a,collection:o}),Object.entries(s.values).forEach(([u,d])=>{let p=k(d);p.isValid||t.push({type:"INVALID_VALUE_FORMAT",message:p.error||`Invalid value format for token '${a}' in mode '${u}'`,tokenName:a,collection:o,mode:u,value:d})})}),{isValid:t.length===0,errors:t,warnings:n}):(t.push({type:"INVALID_COLLECTION",message:`Collection '${o}' is not defined`,collection:o}),{isValid:!1,errors:t,warnings:n})}function re(e,r){let t=[],n=[];return Q(e).forEach(({tokenName:i,collection:a,mode:s,value:l,result:c})=>{if(!c.isValid){t.push({type:"INVALID_VALUE_FORMAT",message:c.error||"Invalid value format",tokenName:i,collection:a,mode:s,value:l});return}c.value&&g(c.value).forEach(({collection:d,token:p})=>{let E=`$${d}.${p}`;r.find(G=>G.token.name===E)||t.push({type:"INVALID_PRIMITIVE_TOKEN",message:`Referenced token '${E}' not found`,tokenName:i,collection:a,mode:s,value:l})})}),{isValid:t.length===0,errors:t,warnings:n}}function L(e,r){let t=[],n=[];e.forEach(s=>{let l=ee(s,r);t.push(...l.errors),n.push(...l.warnings)});let o={kind:"TokenCollections",metadata:{id:"temp",name:"temp"},data:Array.from(r.values())},i=v(e,o),a=re(i.tokens,i.tokens);return t.push(...a.errors),n.push(...a.warnings),{isValid:t.length===0,errors:t,warnings:n}}function b(e,r){let t=new Map(r.data.map(o=>[o.name,o])),n=L(e,t);if(!n.isValid)throw console.error("Token validation failed:"),n.errors.forEach(o=>{console.error(`  ${o.message}`)}),new Error("Token validation failed. Please fix the errors above.");return n.warnings.length>0&&(console.warn("Token validation warnings:"),n.warnings.forEach(o=>{console.warn(`  ${o}`)})),v(e,r)}function S(e,r,t){return{resolve(n){return m(n,e,r,t)},resolveTokenRef(n){let o=`$${n.collection}.${n.token}`;if(!e.find(s=>s.token.name===o))throw new Error(`Token not found: ${o}`);return`var(${t(o)})`}}}function m(e,r,t,n){switch(e.kind){case"TokenRef":let o=`$${e.collection}.${e.token}`;if(!r.find(s=>s.token.name===o))throw new Error(`Token not found: ${o}`);return{kind:"StringValue",value:`var(${n(o)})`};case"ShadowLayer":return{kind:"ShadowLayer",color:m(e.color,r,t,n),offsetX:m(e.offsetX,r,t,n),offsetY:m(e.offsetY,r,t,n),blur:m(e.blur,r,t,n),spread:m(e.spread,r,t,n)};case"Shadow":return{kind:"Shadow",layers:e.layers.map(s=>m(s,r,t,n))};default:return e}}var T={};P(T,{cssVars:()=>oe,generateCssVariables:()=>j,generateFromAst:()=>A});function V(e){return typeof e=="string"?e:typeof e=="number"?e.toString():f(e)}function $(e,r,t,n){let o=String(e);if(!o.startsWith("$")){let s=k(o);if(s.isValid&&s.value){let c=S(r,"default",u=>t(u,n)).resolve(s.value);return V(c)}return e}let i=k(o);if(!i.isValid||!i.value)throw new Error(`Invalid token reference: ${o}`);return S(r,"default",s=>t(s,n)).resolveTokenRef(i.value)}function C(e,r){let t=e.replace(/^\$/,"").replace(/\./g,"-");return r?`--${r}-${t}`:`--${t}`}function te(e,r,t,n){let o=e.values.find(s=>s.mode===r);if(!o)throw new Error(`No value found for token '${e.token.name}' in mode '${r}'`);let i=$(o.value,t,C,n);return`${C(e.token.name,n)}: ${V(i)};`}function ne(e,r,t,n,o){let i=r.map(a=>`  ${te(a,t,n,o)}`).join(`
`);return`${e} {
${i}
}`}function A(e,r){let{prefix:t,banner:n="",selectors:o={}}=r,{tokens:i,collections:a}=e,s=a.flatMap(l=>{let c=i.filter(u=>u.token.collection===l.name);return l.modes.map(u=>{var p;let d=((p=o[l.name])==null?void 0:p[u])||":root";return ne(d,c,u,i,t)})}).join(`

`);return`${n}${s}`}function j(e,r,t={}){let n=b(e,r);return A(n,t)}var oe={generateCssVariables:j,generateCssVarsFromAst:A,createCssVarName:C};var w={};P(w,{generateFromAst:()=>D,generateTailwindCSS:()=>M,tailwind:()=>ae});function I(e,r){let t=e.replace(/^\$/,"");return t.startsWith("number.")?t=t.replace("number.","spacing-"):t.startsWith("letter-spacing.")?t=t.replace("letter-spacing.","tracking-"):t=t.replace(/\./g,"-"),r?`--${r}-${t}`:`--${t}`}function ie(e,r,t){let{prefix:n}=t,o=[],i=new Set;return e.forEach(a=>{if(i.has(a.token.name))return;i.add(a.token.name);let s=a.values.find(d=>d.mode===r);if(!s)return;let l=$(s.value,e,I,n),c=V(l);a.token.name==="$number.1"&&o.push(`  --spacing: ${c};`);let u=I(a.token.name,n);o.push(`  ${u}: ${c};`)}),o.length>0?`@theme {
${o.join(`
`)}
}`:""}function se(){let e=[];return e.push("@utility bg-* { background-color: var(--color-*, var(--color-palette-*)); }","@utility text-* { color: var(--color-*, var(--color-palette-*)); }","@utility border-* { border-color: var(--color-*, var(--color-palette-*)); }","@utility fill-* { fill: var(--color-*, var(--color-palette-*)); }","@utility stroke-* { stroke: var(--color-*, var(--color-palette-*)); }","","@utility font-* { font-weight: var(--font-weight-*); }","@utility tracking-* { letter-spacing: var(--tracking-*); }","","@utility p-* { padding: var(--spacing-*); }","@utility px-* { padding-left: var(--spacing-*); padding-right: var(--spacing-*); }","@utility py-* { padding-top: var(--spacing-*); padding-bottom: var(--spacing-*); }","@utility pt-* { padding-top: var(--spacing-*); }","@utility pr-* { padding-right: var(--spacing-*); }","@utility pb-* { padding-bottom: var(--spacing-*); }","@utility pl-* { padding-left: var(--spacing-*); }","","@utility m-* { margin: var(--spacing-*); }","@utility mx-* { margin-left: var(--spacing-*); margin-right: var(--spacing-*); }","@utility my-* { margin-top: var(--spacing-*); margin-bottom: var(--spacing-*); }","@utility mt-* { margin-top: var(--spacing-*); }","@utility mr-* { margin-right: var(--spacing-*); }","@utility mb-* { margin-bottom: var(--spacing-*); }","@utility ml-* { margin-left: var(--spacing-*); }","","@utility w-* { width: var(--spacing-*); }","@utility h-* { height: var(--spacing-*); }","@utility min-w-* { min-width: var(--spacing-*); }","@utility min-h-* { min-height: var(--spacing-*); }","@utility max-w-* { max-width: var(--spacing-*); }","@utility max-h-* { max-height: var(--spacing-*); }","@utility gap-* { gap: var(--spacing-*); }","@utility space-x-* { & > * + * { margin-left: var(--spacing-*); } }","@utility space-y-* { & > * + * { margin-top: var(--spacing-*); } }","@utility rounded-* { border-radius: var(--spacing-*); }","","@utility shadow-* { box-shadow: var(--shadow-*); }","@utility border-width-* { border-width: var(--border-width-*); }"),e}function D(e,r){let{banner:t=""}=r,{tokens:n,collections:o}=e,i=[];t&&i.push(t),i.push('@import "tailwindcss";'),i.push(""),o.forEach(s=>{let l=n.filter(c=>c.token.collection===s.name);s.modes.forEach(c=>{let u=ie(l,c,r);u&&(i.push(u),i.push(""))})});let a=se();return a.length>0&&(i.push(...a),i.push("")),i.join(`
`)}function M(e,r,t={}){let n=b(e,r);return D(n,t)}var ae={generateTailwindCSS:M,generateTailwindFromAst:D,createTailwindVarName:I};var de=le(import.meta.url),fe=de.resolve("@cocso-ui/baseframe-sources"),pe=R.dirname(fe);function _(){process.stdout.write(`
\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2557   \u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255D
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2588\u2588\u2588\u2588\u2554\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2557  
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u255A\u2550\u2550\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u255D  \u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2551\u255A\u2588\u2588\u2554\u255D\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255D  
\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551     \u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551 \u255A\u2550\u255D \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557
\u255A\u2550\u2550\u2550\u2550\u2550\u255D \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u255D

`)}function ge(e){let r=[];function t(n){let o=h.readdirSync(n);for(let i of o){let a=R.join(n,i),s=h.statSync(a);s.isDirectory()?t(a):s.isFile()&&/\.ya?ml$/.test(i)&&r.push(a)}}return t(e),r}function Y(){let e=ge(pe),r=[],t=null;for(let n of e)try{let o=h.readFileSync(n,"utf-8"),i=ce.parse(o);i.kind==="Tokens"?r.push(i):i.kind==="TokenCollections"&&(t=i)}catch(o){console.warn(` \u274E failed to parse ${n}:`,o)}return t||(console.error(" \u274E collections.yaml not found"),process.exit(1)),{tokens:r,collections:t}}function me(e,r){let{tokens:t,collections:n}=Y(),o=T.generateCssVariables(t,n,{prefix:r,banner:"",selectors:{global:{default:":root"}}});h.ensureDirSync(e);let i=R.join(e,"tokens.css");h.writeFileSync(i,o,"utf-8"),console.log(` \u2705 Generated CSS variables: ${i}`)}function he(e,r){let{tokens:t,collections:n}=Y(),o=w.generateTailwindCSS(t,n,{prefix:r,banner:""});h.ensureDirSync(e);let i=R.join(e,"tailwind.css");h.writeFileSync(i,o,"utf-8"),console.log(` \u2705 Generated TailwindCSS 4.0 configuration: ${i}`)}ue(process.argv.slice(2)).command("css-vars [dir] [prefix]","Generate CSS variables",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{_(),me(e.dir,e.prefix)}).command("tailwindcss [dir] [prefix]","Generate TailwindCSS 4.0 configuration",e=>e.positional("dir",{describe:"Output directory",type:"string",default:"./dist/"}).option("prefix",{describe:"CSS variable prefix",type:"string"}),e=>{_(),he(e.dir,e.prefix)}).demandCommand(1,"You need to specify a command.").showHelpOnFail(!0).help().argv;
